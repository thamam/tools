#!/bin/bash

# Voice Transcription Tool launcher script
# This script handles virtual environment activation and launches the application

APP_DIR="/usr/share/voice-transcription-tool"
VENV_DIR="$APP_DIR/.venv"

# Check if virtual environment exists
if [ ! -d "$VENV_DIR" ]; then
    echo "Error: Virtual environment not found at $VENV_DIR"
    echo "Please reinstall the package: sudo apt install --reinstall voice-transcription-tool"
    exit 1
fi

# Function to run the application
run_app() {
    cd "$APP_DIR"
    source "$VENV_DIR/bin/activate"
    python3 main.py "$@"
}

# Check if running as root (for global hotkeys)
if [ "$EUID" -eq 0 ]; then
    echo "Running with sudo - global hotkeys enabled"
    # Set DISPLAY for GUI when running with sudo
    if [ -z "$DISPLAY" ]; then
        export DISPLAY=:0
    fi
    # Set XDG_RUNTIME_DIR for the actual user
    if [ -n "$SUDO_USER" ]; then
        export XDG_RUNTIME_DIR="/run/user/$(id -u $SUDO_USER)"
    fi
fi

# Run the application
run_app "$@"